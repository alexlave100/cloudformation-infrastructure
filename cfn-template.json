{
"AWSTemplateFormatVersion": "2010-09-09",
    
    "Description": "Creates a highly available and elastic architecture to deploy a simple web application for adding and removing notes. We call it LoserApp",

    "Parameters": {
      "CidrBlockRange": {
        "Type": "String",
        "Default": "10.0.0.0/16",
        "Description": "CIDR block range of the VPC being created in the template."
      }
    },

    "Resources": {
      "LARouteTableAssociation1": {
        "Type": "AWS::EC2::SubnetRouteTableAssociation",
        "Properties": {
          "RouteTableId": { "Ref": "LARouteTable" },
          "SubnetId": { "Ref": "PubSubnet1" }
        }
      },
      "LARouteTableAssociation2": {
        "Type": "AWS::EC2::SubnetRouteTableAssociation",
        "Properties": {
          "RouteTableId": { "Ref": "LARouteTable" },
          "SubnetId": { "Ref": "PubSubnet2" }
        }
      },
      "LARouteTable": {
        "Type": "AWS::EC2::RouteTable",
        "Properties": {
          "VpcId": { "Ref": "LoserAppVPC" },
          "Tags" : [
            { "Key": "Name", "Value": "la-routetable" }
          ]
        }
      },
      "LAInternetGateway": {
        "Type": "AWS::EC2::InternetGateway",
        "Properties": {
          "Tags": [
            { "Key": "Name", "Value": "la-internetgateway" }
          ]
        }
      },
      "LARoute": {
        "Type": "AWS::EC2::Route",
        "Properties": {
          "DestinationCidrBlock": "0.0.0.0/0",
          "RouteTableId": { "Ref": "LARouteTable" },
          "GatewayId": { "Ref": "LAInternetGateway" }
        }
      },
      "LAVPCGatewayAttachement": {
        "Type": "AWS::EC2::VPCGatewayAttachment",
        "Properties": {
          "InternetGatewayId": { "Ref": "LAInternetGateway" },
          "VpcId": { "Ref": "LoserAppVPC" }
        }
      },
      "LoserAppVPC": {
        "Type": "AWS::EC2::VPC",
        "Properties": {
          "CidrBlock": { "Ref": "CidrBlockRange" },
          "EnableDnsHostnames": false,
          "EnableDnsSupport": true,
          "InstanceTenancy": "default",
          "Tags": [
            { "Key": "Name", "Value": "la-vpc" }, 
            { "Key": "Id", "Value": "001"},
            { "Key": "Region", "Value": { "Ref": "AWS::Region" } },
            { "Key": "AccountId", "Value": { "Ref": "AWS::AccountId" } } ]
        }
      },
      "PubSubnet1": {
        "Type": "AWS::EC2::Subnet",
        "Properties": {
          "AvailabilityZone": {
            "Fn::Select": [
              "0",
              {
                "Fn::GetAZs": ""
              }
            ]
          },
          "CidrBlock": "10.0.0.0/24",
          "MapPublicIpOnLaunch": "true",
          "Tags": [
            { "Key": "Name", "Value": "la-pubsubnet1" },
            { "Key": "Id", "Value": "001" },
            { "Key": "VPCName", "Value": "LoserAppVPC" } ],
          "VpcId": { "Ref": "LoserAppVPC" }
        }
      },
      "PubSubnet2": {
        "Type": "AWS::EC2::Subnet",
        "Properties": {
          "AvailabilityZone": {
            "Fn::Select": [
              "1",
              {
                "Fn::GetAZs": ""
              }
            ]
          },
          "CidrBlock": "10.0.1.0/24",
          "MapPublicIpOnLaunch": "true",
          "Tags": [
            { "Key": "Name", "Value": "la-pubsubnet2" },
            { "Key": "Id", "Value": "002" },
            { "Key": "VPCName", "Value": "LoserAppVPC" } ],
          "VpcId": { "Ref": "LoserAppVPC" }
        }
      },
      "PrivSubnet1": {
        "Type": "AWS::EC2::Subnet",
        "Properties": {
          "AvailabilityZone": {
            "Fn::Select": [
              "0",
              {
                "Fn::GetAZs": ""
              }
            ]
          },
          "CidrBlock": "10.0.2.0/24",
          "MapPublicIpOnLaunch": "false",
          "Tags": [
            { "Key": "Name", "Value": "la-privsubnet1" },
            { "Key": "Id", "Value": "001" },
            { "Key": "VPCName", "Value": "LoserAppVPC" } ],
          "VpcId": { "Ref": "LoserAppVPC" }
        }
      },
      "PrivSubnet2": {
        "Type": "AWS::EC2::Subnet",
        "Properties": {
          "AvailabilityZone": {
            "Fn::Select": [
              "1",
              {
                "Fn::GetAZs": ""
              }
            ]
          },
          "CidrBlock": "10.0.3.0/24",
          "MapPublicIpOnLaunch": "true",
          "Tags": [
            { "Key": "Name", "Value": "la-privsubnet2" },
            { "Key": "Id", "Value": "002" },
            { "Key": "VPCName", "Value": "LoserAppVPC" } ],
          "VpcId": { "Ref": "LoserAppVPC" }
        }
      }
    },

    "Outputs": {
      "VpcPhysicalId" : {
        "Description": "Physical ID of the created VPC.",
        "Value": { "Ref": "LoserAppVPC" }
      }
    }
}